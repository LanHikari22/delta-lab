library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;
use work.custom_types.all;


entity busmux_t is -- conflicts with megafunction library from Quartus Prime
generic (DATAW: integer := 8; ADDRW: integer := 4);
port (
	sel: in unsigned(ADDRW-1 downto 0);
	din: in bus_arr (0 to 2**ADDRW-1)(0 to DATAW-1);
	dout: out std_logic_vector(DATAW-1 downto 0)
);
end entity;

architecture dataflow of busmux_t is
begin
	dout <= din(to_integer(sel));
end architecture;



-- testbench ----------------------------------------------------------------------
library ieee
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;
use work.custom_types.all;
use work.testbench_utils.all;

entity busmux_t_tb is end entity;

architecture tb of busmux_t_tb is
	constant T: time := 1 ns; -- wait period of simulation

	constant DATAW: integer := 4;
	constant ADDRW: integer := 2;

	signal sel: in unsigned(ADDRW-1 downto 0);
	signal din: in bus_arr (0 to 2**ADDRW-1)(0 to DATAW-1) := (x"0", x"1", x"2", x"3");
	signal dout: out std_logic_vector(DATAW-1 downto 0)
	signal dout_exp: out std_logic_vector(DATAW-1 downto 0)

begin
	UUT: entity work.busmux_t generic map (DATAW, ADDRW) port map (sel, din, dout);

	test: process is
	begin
		
		report_tests_pass_status;
		wait;
	end process;
end architecture;
